## 日記

### 10/4 12:30

12時の開始直後に偶然気付いたので問題を読む。
面白そう。
なんというかmemory allocationとかschedulingという語が連想される。
生成されるクッキーの面積や時間や得点の傾向への依存が強そう。
とりあえず貪欲をしたい。

### 10/4 13:50

中身のコードを読んでる。

乱数生成器がxorshiftなのでにゃんできないかな。
まあ難しいしできてもあまり使えなさそう。

盤面は 20 x 20 で固定。
これけっこう小さい気がする。

生地生成は次の手順:

1.  外周の半分を一様乱数で選ぶ
    -   小 [2, 5] x 2
    -   大 [7, 10] x 2
1.  折る位置を一様乱数で選ぶ
1.  縦横比を計算
1.  原始スコアを一様乱数で選ぶ
    -   小 [27, 45]
    -   大 [1280, 1920]
1.  スコア係数を一様乱数で選ぶ
    -   小 [0.2, 0.4]
    -   大 [x - 0.3, x + 0.3] ただし x in [0.3, 0.6] は事前に固定される
1.  スコアを計算
    -   原始スコア x スコア係数
1.  必要加熱ターン数を計算
    -   原始スコア / 面積

面積 x 時間 がだいたい点数になるようになってる。
回転率の方が重要だしオーブンの稼働率だけ見るのでよさそう。

## 10/4 15:00

とりあえず貪欲を書いたので提出。
左上から置けるものを置いていくだけ。
手元のTotalScore: 2,418,095で順位表は2位。

## 10/4 15:20

ちょっと修正したら1位。
TotalScore: 2,474,989。
kurenai3110 と kosakkun を煽って今日は終了です。

## 10/8 11:00

多少手の込んだ戦略をしてみたがだめ。
TotalScore: 2,323,048とか。

## 10/8 13:00

そもそも小型クッキーはたいして効いておらず70,000とかだけなので、ひとまずは大型クッキーのみに絞って頑張るのがよさそう。

ちゃんとやったら TotalScore: 2,515,121。
まあビームサーチ。

## 10/8 14:00

`ステータス：warning-error` って出るのが解消できない。
compileに失敗したのか実行時に失敗したのか曖昧だしもうちょっとまともな表示をしてほしい。
もし前者ならどういう環境なのか、せめてcompilerの名前ぐらいはほしいのだけどどこにも書いてない。

compileに失敗するようなものを投げるとこれも `ステータス：warning-error` だが `エラーメッセージ：` にcompilerの出力が表示される。
`エラーメッセージ：` と `Runtime Error` が別の行にあるので勘違いしていたが、標準エラー出力の欄ではなく単に RE したということを言っているらしい。

## 10/8 15:40

やっと解決。
おそらく内部でMLEしていた。

## 10/8 19:10

ジャッジか順位表かのどちらかが壊れていてTLEが存在してないように見える。
まあ放っておけばmask解除のときに顕在化して直るでしょう。

## 10/8 19:20

ビームサーチ中でWaitをしてなかったのをなんとかした。
手元 TotalScore: 2,619,656。
提出できる時間にも収めて6位。

要パラメタ調整。
深さはあまりいらないぽいなど。

手元チェックはせめて100ケースでやるべき。
あとちゃんと並列化と集計をする。
どちらも微妙に面倒なので面倒。

## 10/8 21:00

点数がまったく伸びないのでつらくなってきた。
まだ今日は2日目だし今日は終わりです。

## 10/9 15:00

時間制限が付いたらしい。
リジャッジもあった。
でもスコア公開はなし。

## 10/9 17:00

細かいバグを潰して鯖上のスコア 2,537,201から2,555,858に。
7位から5位。
まだこのあたりは混戦か。
とりあえずは差分更新などをきっちり書いて定数倍高速化か。

## 10/9 21:20

ぜんぜんだめ。
定数倍高速化すらあまりうまくいってない。

## 10/9 22:00

諸々のバグが取れた結果か、深さを上げるのがちゃんと効くようになった。

ひとまず次はパラメタ調整と定数倍高速化か。
評価関数の実際の値を確認して詳細な検討するやつも必要。

## 10/10 18:20

朝にお風呂で思い付いた点を修正したが失敗。
ついでに1点修正したらそっちは効いて1位。
スコア 2,643,051。
試したのはどちらも小型クッキーと大型クッキーの干渉防止の機構で、失敗した方はビームサーチをだんだん細めて先の方までの結果を得るもの、成功した方はそれ用の不等式に余裕持たせてたのを厳密にしたもの。

ビームをだんだん細めるのでなくてビーム結果に貪欲に後ろを付け足すとかするのも試す。
小型クッキーのビームサーチ化はやってないままなので忘れずやる。

## 10/10 18:40

しかしちゃんと時間を使ってるのがまだ3人しかいない。
まだまだ中盤戦という感じがする。
むしろ9秒や0.5秒で上位の人の方が怖い。

```
順位	ニックネーム	区分	応募日時	スコア	時間(秒)
1	kimiyuki	学生	2018-10-10 18:23:11	2,643,051	57.6875
2	kurenai3110	学生	2018-10-08 01:28:42	2,620,558	58.0625
3	kotamanegi	学生	2018-10-09 08:29:46	2,607,481	54.8359
4	c7c7	学生	2018-10-10 17:41:58	2,589,527	9.6796
5	さはら	学生	2018-10-10 13:45:02	2,583,597	28.5625
6	sk	学生	2018-10-09 21:38:00	2,571,812	16.8593
7	noge	ハル研	2018-10-09 23:05:58	2,555,462	1.7187
8	aquaCS	学生	2018-10-07 15:27:16	2,551,207	2.5234
9	Intyamada	学生	2018-10-07 00:15:43	2,547,038	0.5703
10	planetary	学生	2018-10-07 02:24:06	2,538,458	1.2109
```

やってないこと。
評価関数の高速な差分更新。
評価関数の実際の値の確認。
ビームサーチ結果の木の使い回し。
スコア値がぴったり一致するかで重複排除はどうか。
現状のアルゴリズムだと「焼き時間の長いクッキーが焼け終わった後その次が上手く焼けるか」がほぼ考慮できてない。

## 10/10 19:00

ほとんど同じ提出を投げてもTLEしたりしなかったりする。
風水みがつよい。

## 10/11 00:00

kurenai3110に1位を奪われたので頑張る

## 10/11 05:00

もうだめ

## 10/11 06:10

なんとか勝利を収めた。
小型クッキーのビームサーチ化が芳しくなかったので、もうむしろまったくの貪欲でよくないかと思って試したら正解。
さらにビーム幅を縮めるやつも加えたらこれも正解だった。
kurenai3110を煽って就寝。

## 10/11 06:20

そういえば小型クッキー主体で戦うとよいケースがあるかどうか確認してない。

ところで焼き鈍し方面を検討してない。
大型クッキーならどうせ重ならないしありなのでは。

## 10/11 16:50

差分更新とかいろいろしてみたけどどれもほぼはずれ。
計算量落としてるのに鯖上で速度低下したりする。
向こうがそもそもどんな環境で動いてるのか分からないので虚無みがある。

## 10/15 18:00

抜かれた(<https://twitter.com/shr_em/status/1050467066115837957>)がその後特に変化なし。
参加者実質3人全員やる気なさすぎかという気分になるがよく見ると4位以下が詰めてきていてこわい。

```
順位	ニックネーム	区分	応募日時	スコア	時間(秒)
1	さはら	学生	2018-10-12 19:01:06	2,715,436	53.4140
2	kimiyuki	学生	2018-10-11 15:46:26	2,682,814	49.1406
3	kurenai3110	学生	2018-10-11 00:14:10	2,665,473	57.6562
4	kotamanegi	学生	2018-10-15 01:07:16	2,662,411	59.4218
5	sugano	ハル研	2018-10-11 22:27:29	2,614,860	17.1093
6	nii	学生	2018-10-15 12:55:37	2,611,996	48.0156
7	hirata	ハル研	2018-10-14 22:50:56	2,594,212	3.4140
8	sk	学生	2018-10-15 16:23:36	2,591,401	22.3515
9	risujiroh	学生	2018-10-14 05:58:53	2,590,132	2.3750
10	c7c7	学生	2018-10-10 17:41:58	2,589,527	9.6796
```

1位に勝つには平均1700点くらい上げればよい。
焼き鈍しをやっていきます。

## 10/15 19:40

`-Werror` が面倒。
業務じゃないんだから楽しくコーディングをさせてほしい。
でもよく考えたら外して提出して通るか確認してないね。

## 10/15 23:20

小さいクッキーだけ戦略は自明にだめ。
そもそも小さいクッキーだと平均10点程度しかないので毎回置いても10000点を越えない。

## 10/16 02:50

焼き鈍し解が鯖上で 2,605,170 に到達。

## 10/16 06:10

焼き鈍し解ははずれな気がしてきた。
配置はどちらかと言えばofflineに見えるが、ひとつ置いたら次のものが出現するという点で非常にonline。
どうせ全部置けるからどういう順番で置いてもいいなどということはなく、何が追加されても対応できるよう空間を確保しつつ置く必要がある。
これは順序に強く依存するため焼き鈍すのは面倒。
貪欲がやけに強いのもこれに起因するのだろう。

## 10/16 07:30

分からない。
締切間際にがちゃをする様子が目に浮かぶ。

焼き鈍しが失敗だとするとあとはビームサーチ高速化ぐらいか。

## 10/16 18:10

ビームサーチの幅を10倍にしてえいってすると効いた。
100ステージが TotalScore: 13,733,831 から 13,773,302 に。
しかし1ステージあたり400点しか変わってないとも言う。
1位との差は20ステージで32622点。

## 10/16 23:40

ビームサーチも無理っぽい。
順序を考慮しなくていいなら当然焼き鈍しがつよくて、1位とるにはこっちに賭けるべきな気がする。

ビームサーチの評価関数を見ていると面積の重みがとても大きくて、値域が実質R^2になってる。
つまり貪欲。

## 10/17 01:00

厳しい。
ビームサーチだと実質面積で貪欲が最適なのでわりとどうにもならなさげ。
眺めていても自明なミスはなく、全体的にちょっとずつ弱い面倒な状況。
一方で焼き鈍しは順序の考慮が弱い。
端から大きいのを時刻的に順番に置いていくべきだがそうならない。

改善の余地も見えていてかつ上手くやったときの到達点は焼き鈍しの方が高いので焼き鈍しか。
配置時刻を変数に加えるのはありそう。
ビームサーチをchokudai化して多様性を得る手はある。

1位が更新されて差は20ステージで40400点。

## 10/17 4:40

焼き鈍し解でも鯖上 2,651,689 でました。

## 10/17 7:20

分からない。だめ。chokudai化も失敗。

小型クッキー重点で2000点増やせないかと思うが、そもそもすでに5000 ~ 8000点を小型で得ており上限は10000点と見てよいのでこれ以上は難しい。
残るはクッキー形状で分岐ensembleか。
苦肉の策すぎる。

## 10/17 8:10

もうだめ。ねる。

1位の点数おかしいでしょという気持ちしかない。
配列外参照でうっかり不正しちゃってる系のあれだったりしないだろうか。
去年それで記録取り消されて泣いた人もいたらしいし。
そもそもなんで回答と判定機と分けてないのか。

焼き鈍しの結果使い回しはまだやってないし効くのではないか。
明日やる。
効いてくれ頼む。

## 10/17 17:20

抜かれていた。なぜ。

```
順位	ニックネーム	区分	応募日時	スコア	時間(秒)
1	さはら	学生	2018-10-17 14:41:36	2,728,316	55.5000
2	sugano	ハル研	2018-10-17 08:16:55	2,709,467	59.2109
3	kimiyuki	学生	2018-10-16 21:51:51	2,684,068	50.7031
4	kurenai3110	学生	2018-10-11 00:14:10	2,665,473	57.6562
5	kotamanegi	学生	2018-10-15 01:07:16	2,662,411	59.4218
6	nii	学生	2018-10-17 17:22:32	2,660,940	50.4609
7	masayuki	ハル研	2018-10-17 00:52:59	2,644,132	56.6328
8	hirata	ハル研	2018-10-17 02:12:50	2,630,895	50.1015
9	鮟鱇狸鍋	学生	2018-10-16 23:38:15	2,628,357	20.2890
10	toto	学生	2018-10-17 01:19:36	2,619,675	8.9218
```

朝から回しておいた実行時間10倍焼き鈍しが終わっていたが、点数はあまり変わっていなかった。

## 10/17 17:30

やること。
焼き鈍しの結果使い回し。
小型クッキーもまとめて焼く。
ビームサーチ解で、置く場所を絞る。

統計とってensembleとかGUI書いて手で上限把握するのもやるべきだけど時間がない。

## 10/17 22:00

焼き鈍しの結果使い回しはできた。
これにより、大型クッキーのみの場合、時間を注ぎ込めばビームサーチの結果を大きく越えてくれるようになった。

小型クッキーとの食い合せは依然として悪い。
むしろ悪化するまである。
小型クッキーもまとめて焼けばよさそうに見えるが、時刻の重なりがちょっとこわいかも。

## 10/18 00:30

もうだめ。
小型クッキーをまとめて焼くのは上手くいかない。
次に出てくるクッキーを真面目に予想して上手くやるとかすべきか。
評価値をちゃんとR^2の要素として書いて適切に焼き鈍すべきか。

## 10/18 01:00

どうにもならない。
今回は負けです。
諦めたので寝ます。

## 10/18 01:20

試してない案ひとつ思いついたので再開。
焼き鈍しの際にひとつひとつ動かすのでなくて全部まとめて落下させるのは望みがある。
2048的な感じ。

## 10/18 20:00

だめ。あまり変わらず。
